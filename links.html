<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>LINKs â€” Zion Church Lisboa</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <script src="config.js"></script>
</head>
<body>
<div class="page-wrapper">
    <div class="banner">
        <img src="banner zion.jpg" alt="Zion Lisboa" onerror="this.style.display='none';document.querySelector('.banner-fallback').classList.add('show');">
        <div class="banner-fallback"><div class="banner-title">ZION</div><div class="banner-sub">Lisboa Â· Portugal</div></div>
        
    </div>
    <div class="gold-line"></div>

    <!-- Pesquisa -->
    <div class="search-bar">
        <input class="search-input" id="search-input" type="text" placeholder="ğŸ”  Pesquisar link, zona ou lÃ­der..." oninput="filtrar()">
    </div>

    <!-- Filtros -->
    <div class="filters-row" id="filters-row">
        <button class="filter-chip all active" onclick="setFiltro('todos','todos')" id="chip-todos">Todos</button>
        <!-- chips dinÃ¢micos -->
    </div>

    <!-- Content -->
    <div class="content" id="main-content">
        <div class="loading"><div class="spin"></div>A carregar LINKs...</div>
    </div>

    <div class="footer">
        <div class="footer-links">
            <a class="footer-link" href="https://zionchurch.org.br/" target="_blank"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>Site Oficial</a>
            <a class="footer-link" href="https://www.instagram.com/zionlisboa/" target="_blank"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>@ZionLisboa</a>
        </div>
        <div class="footer-div"></div>
        <div class="footer-copy">Â© 2026 Zion Lisboa â€” Todos os direitos reservados</div>
        <div class="footer-addr">Rua do Centro Cultural, 11 Â· 1700-036 Alvalade Â· Lisboa, Portugal</div>
    </div>
</div>

<script>
    const SUPA_URL = window.SUPABASE_URL || '';
    const SUPA_KEY = window.SUPABASE_ANON_KEY || '';

    let todosLinks   = [];
    let filtroTipo   = 'todos'; // 'todos' | 'tipo' | 'zona' | 'dia'
    let filtroValor  = 'todos';

    // Emojis por tipo
    const tipoIcone = {
        'FamÃ­lias'  : '',
        'Flow'      : '',
        'VOX'       : '',
        'Online'    : '',
    };
    function icone(tipo) { return tipoIcone[tipo] || ''; }

    // â”€â”€ SUPABASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function sb(path) {
        const r = await fetch(`${SUPA_URL}/rest/v1/${path}`, {
            headers:{'apikey':SUPA_KEY,'Authorization':`Bearer ${SUPA_KEY}`,'Content-Type':'application/json'}
        });
        return r.json();
    }

    // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function init() {
        try {
            const data = await sb('links?select=*&ativo=eq.true&order=tipo,nome');
            todosLinks = Array.isArray(data) ? data : [];
            construirFiltros();
            renderLinks(todosLinks);
        } catch(e) {
            document.getElementById('main-content').innerHTML =
                '<div class="loading">Erro ao carregar LINKs.</div>';
        }
    }

    // â”€â”€ FILTROS DINÃ‚MICOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function construirFiltros() {
        const tipos  = [...new Set(todosLinks.map(l=>l.tipo).filter(Boolean))].sort();
        const zonas  = [...new Set(todosLinks.map(l=>l.zona).filter(Boolean))].sort();
        const dias   = [...new Set(todosLinks.map(l=>l.dia).filter(Boolean))];

        // Ordena dias da semana
        const ordemDias = ['Segunda','TerÃ§a','Quarta','Quinta','Sexta','SÃ¡bado','Domingo'];
        dias.sort((a,b) => {
            const ia = ordemDias.findIndex(d => a.toLowerCase().includes(d.toLowerCase()));
            const ib = ordemDias.findIndex(d => b.toLowerCase().includes(d.toLowerCase()));
            return (ia===-1?99:ia) - (ib===-1?99:ib);
        });

        const row = document.getElementById('filters-row');

        // Separador de tipos
        if (tipos.length > 0) {
            row.insertAdjacentHTML('beforeend',
                `<span style="color:var(--text-faint);font-size:9px;font-family:Cinzel,serif;letter-spacing:1px;text-transform:uppercase;align-self:center;flex-shrink:0">Tipo</span>`
            );
            tipos.forEach(t => {
                row.insertAdjacentHTML('beforeend',
                    `<button class="filter-chip" onclick="setFiltro('tipo','${t}')" data-tipo="${t}">${icone(t)} ${t}</button>`
                );
            });
        }

        if (zonas.length > 0) {
            row.insertAdjacentHTML('beforeend',
                `<span style="color:var(--text-faint);font-size:9px;font-family:Cinzel,serif;letter-spacing:1px;text-transform:uppercase;align-self:center;flex-shrink:0;margin-left:4px">Zona</span>`
            );
            zonas.forEach(z => {
                row.insertAdjacentHTML('beforeend',
                    `<button class="filter-chip" onclick="setFiltro('zona','${z}')" data-zona="${z}">ğŸ“ ${z}</button>`
                );
            });
        }

        if (dias.length > 0) {
            row.insertAdjacentHTML('beforeend',
                `<span style="color:var(--text-faint);font-size:9px;font-family:Cinzel,serif;letter-spacing:1px;text-transform:uppercase;align-self:center;flex-shrink:0;margin-left:4px">Dia</span>`
            );
            dias.forEach(d => {
                const curto = d.replace('-feira','').replace('TerÃ§a','Ter').replace('Quarta','Qua').replace('Quinta','Qui').replace('Segunda','Seg').replace('Sexta','Sex');
                row.insertAdjacentHTML('beforeend',
                    `<button class="filter-chip" onclick="setFiltro('dia','${d}')" data-dia="${d}">ğŸ“… ${curto}</button>`
                );
            });
        }
    }

    function setFiltro(tipo, valor) {
        filtroTipo  = tipo;
        filtroValor = valor;
        // Reset all chips
        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
        // Activate correct chip
        if (tipo === 'todos') {
            document.getElementById('chip-todos').classList.add('active');
        } else {
            const attr = tipo === 'tipo' ? 'data-tipo' : tipo === 'zona' ? 'data-zona' : 'data-dia';
            const chip = document.querySelector(`[${attr}="${valor}"]`);
            if (chip) chip.classList.add('active');
        }
        filtrar();
    }

    // â”€â”€ FILTRAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function filtrar() {
        const q = document.getElementById('search-input').value.toLowerCase().trim();
        let lista = [...todosLinks];

        if (filtroTipo !== 'todos') {
            if (filtroTipo === 'tipo') lista = lista.filter(l => l.tipo === filtroValor);
            if (filtroTipo === 'zona') lista = lista.filter(l => l.zona === filtroValor);
            if (filtroTipo === 'dia')  lista = lista.filter(l => l.dia  === filtroValor);
        }

        if (q) {
            lista = lista.filter(l =>
                (l.nome         || '').toLowerCase().includes(q) ||
                (l.zona         || '').toLowerCase().includes(q) ||
                (l.responsavel  || '').toLowerCase().includes(q) ||
                (l.co_responsavel||'').toLowerCase().includes(q) ||
                (l.dia          || '').toLowerCase().includes(q)
            );
        }

        renderLinks(lista);
    }

    // â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderLinks(lista) {
        const total   = todosLinks.length;
        const online  = todosLinks.filter(l=>l.online).length;
        const zonas   = new Set(todosLinks.map(l=>l.zona).filter(Boolean)).size;

        let html = `
    <div class="stats-bar">
      <div class="stat-pill"><div class="stat-num">${total}</div><div class="stat-label">LINKs</div></div>
      <div class="stat-pill"><div class="stat-num">${zonas}</div><div class="stat-label">Zonas</div></div>
      <div class="stat-pill"><div class="stat-num">${online}</div><div class="stat-label">Online</div></div>
    </div>`;

        if (lista.length === 0) {
            html += `<div class="empty"><div class="empty-icon"></div><div class="empty-txt">Nenhum LINK encontrado.</div></div>`;
            document.getElementById('main-content').innerHTML = html;
            return;
        }

        // Agrupa por tipo
        const grupos = {};
        lista.forEach(l => {
            const t = l.tipo || 'Outros';
            if (!grupos[t]) grupos[t] = [];
            grupos[t].push(l);
        });

        Object.entries(grupos).forEach(([tipo, items]) => {
            html += `
      <div class="group-header">
        ${icone(tipo)} ${tipo}
        <span class="group-header-count">${items.length}</span>
      </div>
      <div class="links-list">`;

            items.forEach((l, i) => {
                const lider     = [l.responsavel, l.co_responsavel].filter(Boolean).join(' Â· ');
                const horario   = l.horario ? `${l.dia||''} ${l.horario}`.trim() : l.dia || '';
                const wapNum    = (l.contato||'').replace(/\D/g,'');
                const linkNome  = encodeURIComponent(l.nome||'LINK');
                const wapMsg    = encodeURIComponent(`OlÃ¡! Gostaria de saber mais sobre o ${l.nome||'LINK'} e participar. Podem me informar como funciona? ğŸ™`);
                const wapUrl    = wapNum ? `https://api.whatsapp.com/send?phone=${wapNum}&text=${wapMsg}` : null;

                html += `
        <div class="link-row" style="animation-delay:${Math.min(i,10)*0.03}s">
          <div class="link-type-icon">${icone(tipo)}</div>
          <div class="link-info">
            <div class="link-nome">
              ${l.nome}
              ${l.online ? '<span class="online-badge">Online</span>' : ''}
            </div>
            <div class="link-meta">
              ${l.zona ? `<span class="link-zona-badge">ğŸ“ ${l.zona}</span>` : ''}
              ${horario ? `<span class="link-dia-badge">ğŸ“… ${horario}</span>` : ''}
            </div>
            ${lider ? `<div class="link-lider">ğŸ‘¤ ${lider}</div>` : ''}
          </div>
          ${wapUrl ? `
          <a class="wap-btn" href="${wapUrl}" target="_blank" rel="noopener">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
            Entrar em Contato
          </a>` : ''}
        </div>`;
            });

            html += '</div>';
        });

        document.getElementById('main-content').innerHTML = html;
    }

    init();
</script>
</body>
</html>
