<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>LINKs ‚Äî Zion Church Lisboa</title>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">

    <script src="config.js"></script>
    <script src="auth.js"></script>
</head>
<body>

<div class="page-wrapper">

    <!-- Banner -->
    <div class="banner">
        <img src="banner zion.jpg"
             onerror="this.style.display='none';document.querySelector('.banner-fallback').classList.add('show');">
        <div class="banner-fallback">
            <div class="banner-title">ZION</div>
            <div class="banner-sub">Lisboa ¬∑ Portugal</div>
        </div>

        <div class="banner-overlay"></div>

        <div class="banner-nav">
            <a href="index.html" class="back-btn">‚Üê In√≠cio</a>
            <span class="page-badge">LINKs</span>
        </div>
    </div>

    <div class="gold-line"></div>

    <!-- Pesquisa -->
    <div class="content">

        <div class="card">
            <input
                id="search-input"
                class="input"
                type="text"
                placeholder="üîç Pesquisar link, zona ou l√≠der..."
                oninput="filtrar()">
        </div>

        <!-- Filtros -->
        <div id="filters-row" style="display:flex;gap:8px;flex-wrap:wrap;margin:12px 0;">
            <button class="chip active" onclick="setFiltro('todos','todos')" id="chip-todos">
                Todos
            </button>
        </div>

        <!-- Conte√∫do -->
        <div id="main-content">
            <div class="card" style="text-align:center">
                <div class="spinner"></div>
                A carregar LINKs...
            </div>
        </div>

    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-links">
            <a class="footer-link" href="https://zionchurch.org.br/" target="_blank">
                Site Oficial
            </a>
            <a class="footer-link" href="https://www.instagram.com/zionlisboa/" target="_blank">
                @ZionLisboa
            </a>
        </div>
        <div class="footer-div"></div>
        <div class="footer-copy">¬© 2026 Zion Lisboa ‚Äî Todos os direitos reservados</div>
        <div class="footer-addr">
            Rua do Centro Cultural, 11 ¬∑ 1700-036 Alvalade ¬∑ Lisboa, Portugal
        </div>
    </div>

</div>

<script>
const SUPA_URL = window.SUPABASE_URL || '';
const SUPA_KEY = window.SUPABASE_ANON_KEY || '';

let todosLinks = [];
let filtroTipo = 'todos';
let filtroValor = 'todos';

async function sb(path) {
    const r = await fetch(`${SUPA_URL}/rest/v1/${path}`, {
        headers:{
            'apikey':SUPA_KEY,
            'Authorization':`Bearer ${SUPA_KEY}`,
            'Content-Type':'application/json'
        }
    });
    return r.json();
}

async function init() {
    try {
        const data = await sb('links?select=*&ativo=eq.true&order=tipo,nome');
        todosLinks = Array.isArray(data) ? data : [];
        construirFiltros();
        renderLinks(todosLinks);
    } catch {
        document.getElementById('main-content').innerHTML =
            `<div class="card">Erro ao carregar LINKs.</div>`;
    }
}

function construirFiltros() {
    const tipos = [...new Set(todosLinks.map(l=>l.tipo).filter(Boolean))].sort();
    const row = document.getElementById('filters-row');

    tipos.forEach(t => {
        row.insertAdjacentHTML('beforeend',
            `<button class="chip" onclick="setFiltro('tipo','${t}')" data-tipo="${t}">
                ${t}
            </button>`
        );
    });
}

function setFiltro(tipo, valor) {
    filtroTipo  = tipo;
    filtroValor = valor;

    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));

    if (tipo === 'todos') {
        document.getElementById('chip-todos').classList.add('active');
    } else {
        const chip = document.querySelector(`[data-${tipo}="${valor}"]`);
        if (chip) chip.classList.add('active');
    }

    filtrar();
}

function filtrar() {
    const q = document.getElementById('search-input').value.toLowerCase().trim();
    let lista = [...todosLinks];

    if (filtroTipo !== 'todos') {
        lista = lista.filter(l => l[filtroTipo] === filtroValor);
    }

    if (q) {
        lista = lista.filter(l =>
            (l.nome || '').toLowerCase().includes(q) ||
            (l.zona || '').toLowerCase().includes(q) ||
            (l.responsavel || '').toLowerCase().includes(q)
        );
    }

    renderLinks(lista);
}

function renderLinks(lista) {

    if (!lista.length) {
        document.getElementById('main-content').innerHTML =
            `<div class="card">Nenhum LINK encontrado.</div>`;
        return;
    }

    const grupos = {};
    lista.forEach(l => {
        const t = l.tipo || 'Outros';
        if (!grupos[t]) grupos[t] = [];
        grupos[t].push(l);
    });

    let html = '';

    Object.entries(grupos).forEach(([tipo, items]) => {

        html += `<p class="section-label">${tipo}</p>`;

        items.forEach(l => {

            const lider = [l.responsavel, l.co_responsavel]
                .filter(Boolean).join(' ¬∑ ');

            const horario = l.horario
                ? `${l.dia || ''} ${l.horario}`.trim()
                : l.dia || '';

            const wapNum = (l.contato||'').replace(/\D/g,'');
            const wapMsg = encodeURIComponent(
                `Ol√°! Gostaria de saber mais sobre o ${l.nome}.`
            );

            const wapUrl = wapNum
                ? `https://api.whatsapp.com/send?phone=${wapNum}&text=${wapMsg}`
                : null;

            html += `
            <div class="card" style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
                <div>
                    <div style="font-family:var(--font-title);font-weight:600;">
                        ${l.nome}
                        ${l.online ? '<span class="badge">Online</span>' : ''}
                    </div>
                    <div style="font-size:12px;color:var(--text-faint);margin-top:4px;">
                        ${l.zona ? `üìç ${l.zona} ¬∑ ` : ''}
                        ${horario}
                    </div>
                    ${lider ? `<div style="font-size:12px;color:var(--text-faint);margin-top:4px;">üë§ ${lider}</div>` : ''}
                </div>

                ${wapUrl ? `
                    <a class="btn" href="${wapUrl}" target="_blank">
                        WhatsApp
                    </a>
                ` : ''}
            </div>`;
        });
    });

    document.getElementById('main-content').innerHTML = html;
}

init();
</script>

</body>
</html>
