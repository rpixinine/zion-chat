<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Localização — Zion Church Lisboa</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="config.js"></script>
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        /* ── Content ─────────────────────────────────────── */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px 18px 24px;
            background: var(--bg-input);
        }
        .content::-webkit-scrollbar { width: 4px; }
        .content::-webkit-scrollbar-thumb { background: rgba(0,144,152,0.25); border-radius: 2px; }

        /* ── Cards ───────────────────────────────────────── */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 18px;
            margin-bottom: 10px;
            box-shadow: var(--shadow-sm);
            animation: fadeUp 0.4s ease both;
        }
        .card--highlight {
            background: linear-gradient(135deg, var(--primary-faint), rgba(0,144,152,0.01));
            border-color: var(--border-strong);
        }

        .card-badge {
            display: inline-block;
            padding: 2px 10px;
            border-radius: var(--radius-full);
            background: var(--primary-faint);
            border: 1px solid var(--border);
            font-family: var(--font-title);
            font-size: 9px;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--primary-dark);
            margin-bottom: 12px;
        }

        /* ── Section label ───────────────────────────────── */
        .section-label {
            font-family: var(--font-title);
            font-size: 10px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--text-faint);
            margin: 18px 0 10px;
        }
        .section-label:first-child { margin-top: 0; }

        /* ── Info rows ───────────────────────────────────── */
        .info-row {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 13px 0;
            border-bottom: 1px solid rgba(0,144,152,0.08);
        }
        .info-row:last-of-type { border-bottom: none; }

        .info-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            background: var(--primary-faint);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--primary-dark);
        }
        .info-icon svg { width: 16px; height: 16px; }

        .info-label {
            font-size: 10px;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--text-faint);
            font-family: var(--font-title);
            margin-bottom: 3px;
        }
        .info-value {
            font-size: 14px;
            color: var(--text-main);
            line-height: 1.55;
        }
        .info-value a {
            color: var(--primary);
            text-decoration: none;
        }
        .info-value a:hover { color: var(--primary-dark); text-decoration: underline; }

        /* ── Horário row ─────────────────────────────────── */
        .culto-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0,144,152,0.08);
        }
        .culto-row:last-child { border-bottom: none; }

        .culto-nome {
            font-family: var(--font-title);
            font-size: 13px;
            color: var(--primary-dark);
            margin-bottom: 2px;
        }
        .culto-desc {
            font-size: 11px;
            color: var(--text-faint);
        }
        .culto-hora {
            font-family: var(--font-title);
            font-size: 13px;
            color: var(--text-main);
            text-align: right;
            flex-shrink: 0;
            margin-left: 12px;
        }
        .culto-hora span {
            display: block;
            font-size: 10px;
            color: var(--text-faint);
            font-family: var(--font-body);
            margin-top: 1px;
        }

        /* ── Map button ──────────────────────────────────── */
        .map-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            border-radius: var(--radius-sm);
            color: #fff;
            text-decoration: none;
            font-family: var(--font-title);
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 14px;
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
        }
        .map-btn:hover { filter: brightness(1.08); box-shadow: var(--shadow-hover); }
        .map-btn svg { width: 14px; height: 14px; }

        /* ── Animation delays ────────────────────────────── */
        .d1{animation-delay:0.05s} .d2{animation-delay:0.10s}
        .d3{animation-delay:0.15s} .d4{animation-delay:0.20s}

        /* ── Banner nav ──────────────────────────────────── */
        .banner-nav {
            position: absolute;
            bottom: 10px; left: 0; right: 0;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px;
        }
        .back-btn {
            display: flex; align-items: center; gap: 6px;
            background: rgba(255,255,255,0.92);
            border: 1px solid var(--border); border-radius: var(--radius-full);
            padding: 5px 14px; font-family: var(--font-title); font-size: 10px;
            letter-spacing: 1.5px; color: var(--primary-dark); text-decoration: none;
            backdrop-filter: blur(8px); box-shadow: var(--shadow-sm); transition: all 0.2s;
        }
        .back-btn:hover { background: #fff; border-color: var(--primary-light); }

        .page-badge {
            font-family: var(--font-title); font-size: 10px; letter-spacing: 2px;
            color: var(--primary); text-transform: uppercase;
            background: rgba(255,255,255,0.92); border: 1px solid var(--border);
            border-radius: var(--radius-full); padding: 5px 14px; backdrop-filter: blur(8px);
        }
        .banner-overlay {
            position: absolute; bottom: 0; left: 0; right: 0; height: 60px;
            background: linear-gradient(to top, rgba(255,255,255,0.95), transparent);
        }
    </style>
</head>
<body>
<div class="page-wrapper">

    <div class="banner">
        <img src="banner zion.jpg" alt="Zion Lisboa"
             onerror="this.style.display='none'; document.querySelector('.banner-fallback').classList.add('show');">
        <div class="banner-fallback">
            <div class="banner-title">ZION</div>
            <div class="banner-sub">Lisboa · Portugal</div>
        </div>
        <div class="banner-overlay"></div>
        <div class="banner-nav">
            <a href="index.html" class="back-btn">← Início</a>
            <span class="page-badge">Localização</span>
        </div>
    </div>

    <div class="gold-line"></div>

    <div class="content" id="main-content">
        <div class="loading"><div class="spin"></div>A carregar...</div>
    </div>

    <div class="footer">
        <div class="footer-links" id="footer-links">
            <a class="footer-link" href="https://zionchurch.org.br/" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                Site Oficial
            </a>
            <a class="footer-link" href="https://www.instagram.com/zionlisboa/" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
                @ZionLisboa
            </a>
        </div>
        <div class="footer-divider"></div>
        <div class="footer-bottom">
            <div class="footer-copy" id="footer-copy">© 2026 Zion Lisboa — Todos os direitos reservados</div>
            <div class="footer-address" id="footer-addr">Rua do Centro Cultural, 11 · 1700-036 Alvalade · Lisboa, Portugal</div>
        </div>
    </div>

</div>

<script>
const SUPA_URL = window.SUPABASE_URL      || '';
const SUPA_KEY = window.SUPABASE_ANON_KEY || '';

async function sb(path) {
    const r = await fetch(`${SUPA_URL}/rest/v1/${path}`, {
        headers: { 'apikey': SUPA_KEY, 'Authorization': `Bearer ${SUPA_KEY}` }
    });
    if (!r.ok) throw new Error(`Supabase ${r.status}`);
    return r.json();
}

// "10:00:00" → "10h00"
function fmtHora(h) {
    if (!h) return '';
    const [hh, mm] = h.split(':');
    return `${hh}h${mm}`;
}

// SVG icons (sem emojis)
const SVG = {
    pin: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>`,
    map: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg>`,
    tel: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 12 19.79 19.79 0 0 1 1.71 3.38 2 2 0 0 1 3.68 1h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 8.56a16 16 0 0 0 5.82 5.82l1.62-1.62a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>`,
    clock: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
    nav: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>`,
};

async function init() {
    try {
        const [cultos, configs] = await Promise.all([
            sb('cultos?select=*&ativo=eq.true&order=created_at.asc'),
            sb('configuracoes?select=chave,valor'),
        ]);

        // Mapa de configs
        const cfg = {};
        (Array.isArray(configs) ? configs : []).forEach(r => { cfg[r.chave] = r.valor; });

        // Dados de endereço
        const endereco  = cfg['endereco']      || 'Rua do Centro Cultural, 11';
        const cp        = cfg['codigo_postal'] || '1700-036';
        const cidade    = cfg['cidade']        || 'Alvalade — Lisboa, Portugal';
        const mapsUrl   = cfg['maps_url']      || 'https://maps.google.com/?q=Rua+do+Centro+Cultural+11+Lisboa';
        const telefone  = cfg['telefone']      || null;
        const instagram = cfg['instagram']     || 'https://www.instagram.com/zionlisboa/';
        const site      = cfg['site']          || 'https://zionchurch.org.br/';

        // Footer
        if (cfg['copy']) document.getElementById('footer-copy').textContent = cfg['copy'];
        const addrLine = [endereco, [cp, cidade].filter(Boolean).join(' ')].filter(Boolean).join(' · ');
        if (addrLine) document.getElementById('footer-addr').textContent = addrLine;

        // Footer links dinâmicos
        document.getElementById('footer-links').innerHTML = `
            <a class="footer-link" href="${site}" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                Site Oficial
            </a>
            <a class="footer-link" href="${instagram}" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
                @ZionLisboa
            </a>`;

        // Agrupar cultos por dia_semana
        const porDia = {};
        (Array.isArray(cultos) ? cultos : []).forEach(c => {
            const dia = c.dia_semana || 'Outro';
            if (!porDia[dia]) porDia[dia] = [];
            porDia[dia].push(c);
        });

        // Ordem preferencial dos dias
        const ORDEM_DIAS = ['Segunda','Terca','Quarta','Quinta','Sexta','Sabado','Domingo'];
        const diasOrdenados = Object.keys(porDia).sort((a, b) => {
            const ia = ORDEM_DIAS.indexOf(a);
            const ib = ORDEM_DIAS.indexOf(b);
            if (ia === -1 && ib === -1) return 0;
            if (ia === -1) return 1;
            if (ib === -1) return -1;
            return ia - ib;
        });

        // Render
        let html = '';
        let delay = 0.05;

        // ── Endereço ──
        html += `<p class="section-label">Campus Lisboa</p>`;
        html += `
        <div class="card d1" style="animation-delay:${delay}s">
            <div class="info-row">
                <div class="info-icon">${SVG.pin}</div>
                <div>
                    <div class="info-label">Endereço</div>
                    <div class="info-value">${endereco}<br>${cp} ${cidade}</div>
                </div>
            </div>
            ${telefone ? `
            <div class="info-row">
                <div class="info-icon">${SVG.tel}</div>
                <div>
                    <div class="info-label">Telefone</div>
                    <div class="info-value"><a href="tel:${telefone}">${telefone}</a></div>
                </div>
            </div>` : ''}
            <div class="info-row">
                <div class="info-icon">${SVG.map}</div>
                <div>
                    <div class="info-label">Mapa</div>
                    <div class="info-value"><a href="${mapsUrl}" target="_blank">Ver no Google Maps →</a></div>
                </div>
            </div>
            <a href="${mapsUrl}" target="_blank" class="map-btn">
                ${SVG.nav}
                Abrir no Google Maps
            </a>
        </div>`;
        delay += 0.07;

        // ── Cultos por dia ──
        if (diasOrdenados.length) {
            html += `<p class="section-label" style="animation-delay:${delay}s">Cultos Semanais</p>`;

            diasOrdenados.forEach(dia => {
                const lista = porDia[dia];
                html += `
                <div class="card" style="animation-delay:${delay}s">
                    <div class="card-badge">${dia}</div>
                    ${lista.map(c => `
                    <div class="culto-row">
                        <div>
                            <div class="culto-nome">${c.nome}</div>
                            ${c.descricao ? `<div class="culto-desc">${c.descricao}</div>` : ''}
                        </div>
                        <div class="culto-hora">
                            ${fmtHora(c.hora_inicio)} — ${fmtHora(c.hora_fim)}
                            <span>${c.recorrente ? 'Semanal' : 'Data especial'}</span>
                        </div>
                    </div>`).join('')}
                </div>`;
                delay += 0.07;
            });
        }

        document.getElementById('main-content').innerHTML = html;

    } catch (e) {
        console.error('Localização init error:', e);
        document.getElementById('main-content').innerHTML =
            `<div class="empty"><div class="empty-icon" style="font-size:36px;opacity:0.3;margin-bottom:8px">!</div><div class="empty-txt">Erro ao carregar. Tenta novamente.</div></div>`;
    }
}

init();
</script>
</body>
</html>
