<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Entrar ‚Äî Zion Church Lisboa</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root{--gold:#B8922A;--gold-light:#D4A843;--gold-dark:#8B6914;--border:rgba(184,146,42,0.22);--bg-page:#F5EFE4;--bg-card:#FFFFFF;--bg-input:#FAF7F2;--bg-footer:#F0E8D8;--text-main:#1A1410;--text-muted:#7A6A52;--text-faint:#A89878;--shadow:0 8px 40px rgba(100,70,20,0.13)}
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
        html,body{height:100%;background:var(--bg-page);font-family:'Lato',sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh}
        body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 15% 15%,rgba(201,168,76,0.09) 0%,transparent 55%),radial-gradient(ellipse at 85% 85%,rgba(201,168,76,0.06) 0%,transparent 55%);pointer-events:none}
        .page-wrapper{position:relative;z-index:1;display:flex;flex-direction:column;width:640px;max-width:96vw;height:96vh;max-height:900px;background:var(--bg-card);border-radius:16px;box-shadow:var(--shadow),0 0 0 1px var(--border);overflow:hidden}
        .banner{width:100%;position:relative;background:#111;flex-shrink:0}.banner img{width:100%;height:120px;object-fit:cover;display:block}
        .banner-fallback{display:none;width:100%;height:120px;background:linear-gradient(135deg,#0d0d0d 0%,#1c1408 50%,#0d0d0d 100%);align-items:center;justify-content:center;flex-direction:column;gap:8px}
        .banner-fallback.show{display:flex}.banner-title{font-family:'Cinzel',serif;color:#C9A84C;font-size:28px;font-weight:700;letter-spacing:10px}
        .banner-sub{color:rgba(201,168,76,0.6);font-size:10px;letter-spacing:4px;text-transform:uppercase}
        .banner-overlay{position:absolute;bottom:0;left:0;right:0;height:60px;background:linear-gradient(to top,rgba(255,255,255,0.95),transparent)}
        .banner-nav{position:absolute;bottom:10px;left:0;right:0;display:flex;align-items:center;justify-content:space-between;padding:0 16px}
        .back-btn{display:flex;align-items:center;gap:6px;background:rgba(255,255,255,0.92);border:1px solid var(--border);border-radius:20px;padding:5px 14px;font-family:'Cinzel',serif;font-size:10px;letter-spacing:1.5px;color:var(--gold-dark);text-decoration:none;backdrop-filter:blur(8px);transition:all 0.2s}
        .back-btn:hover{background:#fff;border-color:var(--gold-light)}
        .page-badge{font-family:'Cinzel',serif;font-size:10px;letter-spacing:2px;color:var(--gold);text-transform:uppercase;background:rgba(255,255,255,0.92);border:1px solid var(--border);border-radius:20px;padding:5px 14px;backdrop-filter:blur(8px)}
        .gold-line{height:2px;background:linear-gradient(90deg,transparent,var(--gold-light),transparent);flex-shrink:0;opacity:0.5}
        .content{flex:1;overflow-y:auto;padding:28px 24px;background:var(--bg-input);display:flex;flex-direction:column;justify-content:center}
        .content::-webkit-scrollbar{width:4px}.content::-webkit-scrollbar-thumb{background:rgba(184,146,42,0.25);border-radius:2px}

        /* Tabs */
        .tabs{display:flex;gap:0;margin-bottom:24px;border-radius:10px;overflow:hidden;border:1px solid var(--border)}
        .tab{flex:1;padding:10px;text-align:center;font-family:'Cinzel',serif;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-faint);cursor:pointer;background:var(--bg-card);transition:all 0.2s;border:none;font-family:'Cinzel',serif}
        .tab.active{background:linear-gradient(135deg,var(--gold-dark),var(--gold-light));color:#fff}

        /* Form */
        .form-section{display:none;animation:fadeUp 0.3s ease both}
        .form-section.active{display:block}
        .form-group{margin-bottom:16px}
        .form-label{display:block;font-family:'Cinzel',serif;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--text-faint);margin-bottom:7px}
        .form-input{width:100%;background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:11px 14px;color:var(--text-main);font-family:'Lato',sans-serif;font-size:14px;outline:none;transition:border-color 0.2s,box-shadow 0.2s}
        .form-input::placeholder{color:var(--text-faint)}
        .form-input:focus{border-color:var(--gold-light);box-shadow:0 0 0 3px rgba(201,168,76,0.1)}
        .form-input.error{border-color:#e05555}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}

        /* Submit */
        .submit-btn{width:100%;padding:13px;background:linear-gradient(135deg,var(--gold-dark),var(--gold-light));border:none;border-radius:8px;color:#fff;font-family:'Cinzel',serif;font-size:11px;letter-spacing:2px;text-transform:uppercase;cursor:pointer;transition:all 0.2s;box-shadow:0 2px 8px rgba(139,105,20,0.25);margin-top:4px}
        .submit-btn:hover{filter:brightness(1.08);box-shadow:0 4px 14px rgba(139,105,20,0.35)}
        .submit-btn:active{transform:scale(0.98)}
        .submit-btn:disabled{opacity:0.6;cursor:not-allowed}

        /* Error / success */
        .msg-box{padding:10px 14px;border-radius:8px;font-size:13px;margin-bottom:16px;display:none;animation:fadeUp 0.3s ease}
        .msg-box.error{background:rgba(220,53,69,0.08);border:1px solid rgba(220,53,69,0.25);color:#c0392b;display:block}
        .msg-box.success{background:rgba(40,167,69,0.08);border:1px solid rgba(40,167,69,0.25);color:#1e7e34;display:block}

        /* Divider */
        .form-divider{text-align:center;color:var(--text-faint);font-size:11px;margin:14px 0;position:relative}
        .form-divider::before,.form-divider::after{content:'';position:absolute;top:50%;width:42%;height:1px;background:var(--border)}
        .form-divider::before{left:0}.form-divider::after{right:0}

        /* Link */
        .form-link{text-align:center;font-size:12px;color:var(--text-faint);margin-top:14px}
        .form-link a{color:var(--gold);text-decoration:none;font-weight:700}
        .form-link a:hover{color:var(--gold-dark)}

        .footer{background:var(--bg-footer);border-top:1px solid var(--border);padding:10px 18px;flex-shrink:0}
        .footer-bottom{display:flex;flex-direction:column;align-items:center;gap:2px}
        .footer-copy{color:var(--text-muted);font-size:10px;letter-spacing:1px;text-transform:uppercase;font-family:'Cinzel',serif;text-align:center}
        .footer-address{color:var(--text-faint);font-size:10px;text-align:center}

        @keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    </style>
</head>
<body>
<div class="page-wrapper">
    <div class="banner">
        <img src="banner zion.jpg" alt="Zion Lisboa" onerror="this.style.display='none';document.querySelector('.banner-fallback').classList.add('show');">
        <div class="banner-fallback"><div class="banner-title">ZION</div><div class="banner-sub">Lisboa ¬∑ Portugal</div></div>
        <div class="banner-overlay"></div>
        <div class="banner-nav">
            <a href="index.html" class="back-btn">‚Üê In√≠cio</a>
            <span class="page-badge">Acesso</span>
        </div>
    </div>
    <div class="gold-line"></div>

    <div class="content">

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('login')">Entrar</button>
            <button class="tab" onclick="switchTab('register')">Registar</button>
        </div>

        <!-- Mensagem de erro/sucesso -->
        <div class="msg-box" id="msgBox"></div>

        <!-- LOGIN -->
        <div class="form-section active" id="tab-login">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input class="form-input" id="login-email" type="email" placeholder="o.teu@email.com" autocomplete="email">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input class="form-input" id="login-password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
            </div>
            <button class="submit-btn" id="login-btn" onclick="doLogin()">Entrar</button>
            <div class="form-divider">ou</div>
            <div class="form-link">
                Ainda n√£o tens conta? <a href="#" onclick="switchTab('register')">Regista-te como Visitante</a>
            </div>
        </div>

        <!-- REGISTER -->
        <div class="form-section" id="tab-register">
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Nome</label>
                    <input class="form-input" id="reg-nome" type="text" placeholder="Nome" autocomplete="given-name">
                </div>
                <div class="form-group">
                    <label class="form-label">Apelido</label>
                    <input class="form-input" id="reg-apelido" type="text" placeholder="Apelido" autocomplete="family-name">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input class="form-input" id="reg-email" type="email" placeholder="o.teu@email.com" autocomplete="email">
            </div>
            <div class="form-group">
                <label class="form-label">Telefone</label>
                <input class="form-input" id="reg-telefone" type="tel" placeholder="+351 9XX XXX XXX" autocomplete="tel">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input class="form-input" id="reg-password" type="password" placeholder="min. 6 caracteres">
                </div>
                <div class="form-group">
                    <label class="form-label">Confirmar</label>
                    <input class="form-input" id="reg-confirm" type="password" placeholder="repetir password">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Como conheceste a Zion?</label>
                <input class="form-input" id="reg-onde" type="text" placeholder="Ex: amigo, Instagram, culto...">
            </div>
            <button class="submit-btn" id="register-btn" onclick="doRegister()">Criar Conta de Visitante</button>
            <div class="form-divider">ou</div>
            <div class="form-link">
                J√° tens conta? <a href="#" onclick="switchTab('login')">Entra aqui</a>
            </div>
        </div>

    </div>

    <div class="footer">
        <div class="footer-bottom">
            <div class="footer-copy">¬© 2026 Zion Lisboa ‚Äî Todos os direitos reservados</div>
            <div class="footer-address">Rua do Centro Cultural, 11 ¬∑ 1700-036 Alvalade ¬∑ Lisboa, Portugal</div>
        </div>
    </div>
</div>

<script src="auth.js"></script>
<script>
    // Redireciona se j√° est√° logado
    if (ZionAuth.isLoggedIn()) {
        const redirect = sessionStorage.getItem('zion_redirect') || 'index.html';
        sessionStorage.removeItem('zion_redirect');
        window.location.href = redirect;
    }

    function switchTab(tab) {
        document.querySelectorAll('.tab').forEach((t, i) => {
            t.classList.toggle('active', (i === 0 && tab === 'login') || (i === 1 && tab === 'register'));
        });
        document.getElementById('tab-login').classList.toggle('active', tab === 'login');
        document.getElementById('tab-register').classList.toggle('active', tab === 'register');
        hideMsg();
    }

    function showMsg(text, type) {
        const el = document.getElementById('msgBox');
        el.textContent = text;
        el.className = `msg-box ${type}`;
    }

    function hideMsg() {
        document.getElementById('msgBox').className = 'msg-box';
    }

    async function doLogin() {
        const email    = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;

        if (!email || !password) return showMsg('Preenche email e password.', 'error');

        const btn = document.getElementById('login-btn');
        btn.disabled = true;
        btn.textContent = 'A entrar...';
        hideMsg();

        try {
            await ZionAuth.login(email, password);
            const redirect = sessionStorage.getItem('zion_redirect') || 'index.html';
            sessionStorage.removeItem('zion_redirect');
            window.location.href = redirect;
        } catch (err) {
            showMsg(err.message || 'Email ou password incorretos.', 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = 'Entrar';
        }
    }

    async function doRegister() {
        const nome     = document.getElementById('reg-nome').value.trim();
        const apelido  = document.getElementById('reg-apelido').value.trim();
        const email    = document.getElementById('reg-email').value.trim();
        const telefone = document.getElementById('reg-telefone').value.trim();
        const password = document.getElementById('reg-password').value;
        const confirm  = document.getElementById('reg-confirm').value;
        const onde     = document.getElementById('reg-onde').value.trim();

        if (!nome || !email || !password) return showMsg('Nome, email e password s√£o obrigat√≥rios.', 'error');
        if (password !== confirm)          return showMsg('As passwords n√£o coincidem.', 'error');
        if (password.length < 6)           return showMsg('Password deve ter pelo menos 6 caracteres.', 'error');

        const btn = document.getElementById('register-btn');
        btn.disabled = true;
        btn.textContent = 'A registar...';
        hideMsg();

        try {
            await ZionAuth.register({ nome: `${nome} ${apelido}`.trim(), email, telefone, password, onde_conheceu: onde });
            showMsg('Conta criada com sucesso! Bem-vindo √† Zion üôè', 'success');
            setTimeout(() => {
                const redirect = sessionStorage.getItem('zion_redirect') || 'index.html';
                sessionStorage.removeItem('zion_redirect');
                window.location.href = redirect;
            }, 1500);
        } catch (err) {
            showMsg(err.message || 'Erro ao criar conta. Tenta novamente.', 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = 'Criar Conta de Visitante';
        }
    }

    // Enter key
    document.addEventListener('keypress', e => {
        if (e.key === 'Enter') {
            const activeTab = document.querySelector('.form-section.active').id;
            if (activeTab === 'tab-login') doLogin();
            else doRegister();
        }
    });
</script>
</body>
</html>