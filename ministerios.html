<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Ministérios — Zion Church Lisboa</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="config.js"></script>
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        /* ── Content ─────────────────────────────────────── */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px 18px 24px;
            background: var(--bg-input);
        }
        .content::-webkit-scrollbar { width: 4px; }
        .content::-webkit-scrollbar-thumb { background: rgba(0,144,152,0.25); border-radius: 2px; }

        /* ── Cards ───────────────────────────────────────── */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 18px;
            margin-bottom: 10px;
            box-shadow: var(--shadow-sm);
            animation: fadeUp 0.4s ease both;
        }
        .card--highlight {
            background: linear-gradient(135deg, var(--primary-faint), rgba(0,144,152,0.01));
            border-color: var(--border-strong);
        }

        .card-badge {
            display: inline-block;
            padding: 2px 10px;
            border-radius: var(--radius-full);
            background: var(--primary-faint);
            border: 1px solid var(--border);
            font-family: var(--font-title);
            font-size: 9px;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--primary-dark);
            margin-bottom: 8px;
        }
        .card-title {
            font-family: var(--font-title);
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 6px;
        }
        .card-text {
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.75;
        }

        /* ── Ministério footer (instagram / responsável) ─── */
        .min-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .min-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            color: var(--text-faint);
        }
        .min-meta-item a {
            color: var(--primary);
            text-decoration: none;
            font-size: 11px;
        }
        .min-meta-item a:hover { text-decoration: underline; }
        .min-meta-item svg { width: 12px; height: 12px; flex-shrink: 0; }

        /* ── Section label ───────────────────────────────── */
        .section-label {
            font-family: var(--font-title);
            font-size: 10px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--text-faint);
            margin: 18px 0 10px;
        }
        .section-label:first-child { margin-top: 0; }

        /* ── Banner nav ──────────────────────────────────── */
        .banner-nav {
            position: absolute;
            bottom: 10px; left: 0; right: 0;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px;
        }
        .back-btn {
            display: flex; align-items: center; gap: 6px;
            background: rgba(255,255,255,0.92);
            border: 1px solid var(--border); border-radius: var(--radius-full);
            padding: 5px 14px; font-family: var(--font-title); font-size: 10px;
            letter-spacing: 1.5px; color: var(--primary-dark); text-decoration: none;
            backdrop-filter: blur(8px); box-shadow: var(--shadow-sm); transition: all 0.2s;
        }
        .back-btn:hover { background: #fff; border-color: var(--primary-light); }

        .page-badge {
            font-family: var(--font-title); font-size: 10px; letter-spacing: 2px;
            color: var(--primary); text-transform: uppercase;
            background: rgba(255,255,255,0.92); border: 1px solid var(--border);
            border-radius: var(--radius-full); padding: 5px 14px; backdrop-filter: blur(8px);
        }
        .banner-overlay {
            position: absolute; bottom: 0; left: 0; right: 0; height: 60px;
            background: linear-gradient(to top, rgba(255,255,255,0.95), transparent);
        }

        /* ── Animation delays ────────────────────────────── */
        .d1{animation-delay:0.05s}
    </style>
</head>
<body>
<div class="page-wrapper">

    <div class="banner">
        <img src="banner zion.jpg" alt="Zion Lisboa"
             onerror="this.style.display='none';document.querySelector('.banner-fallback').classList.add('show');">
        <div class="banner-fallback">
            <div class="banner-title">ZION</div>
            <div class="banner-sub">Lisboa · Portugal</div>
        </div>
        <div class="banner-overlay"></div>
        <div class="banner-nav">
            <a href="index.html" class="back-btn">← Início</a>
            <span class="page-badge">Ministérios</span>
        </div>
    </div>

    <div class="gold-line"></div>

    <div class="content" id="main-content">
        <div class="loading"><div class="spin"></div>A carregar ministérios...</div>
    </div>

    <div class="footer">
        <div class="footer-links" id="footer-links">
            <a class="footer-link" href="https://zionchurch.org.br/" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                Site Oficial
            </a>
            <a class="footer-link" href="https://www.instagram.com/zionlisboa/" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
                @ZionLisboa
            </a>
        </div>
        <div class="footer-divider"></div>
        <div class="footer-bottom">
            <div class="footer-copy" id="footer-copy">© 2026 Zion Lisboa — Todos os direitos reservados</div>
            <div class="footer-address" id="footer-addr">Rua do Centro Cultural, 11 · 1700-036 Alvalade · Lisboa, Portugal</div>
        </div>
    </div>

</div>

<script>
const SUPA_URL = window.SUPABASE_URL      || '';
const SUPA_KEY = window.SUPABASE_ANON_KEY || '';

const SVG_IG   = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>`;
const SVG_USER = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`;

async function sb(path) {
    const r = await fetch(`${SUPA_URL}/rest/v1/${path}`, {
        headers: { 'apikey': SUPA_KEY, 'Authorization': `Bearer ${SUPA_KEY}` }
    });
    if (!r.ok) throw new Error(`Supabase ${r.status}`);
    return r.json();
}

async function init() {
    try {
        const [ministerios, configs] = await Promise.all([
            // Filtra só tipo=ministerio, ativos, ordenados por created_at
            sb('ministerios?select=*&ativo=eq.true&tipo=eq.ministerio&order=created_at.asc'),
            sb('configuracoes?select=chave,valor'),
        ]);

        // Configs
        const cfg = {};
        (Array.isArray(configs) ? configs : []).forEach(r => { cfg[r.chave] = r.valor; });

        // Footer
        if (cfg['copy']) document.getElementById('footer-copy').textContent = cfg['copy'];
        const addr     = cfg['endereco']      || '';
        const cp       = cfg['codigo_postal'] || '';
        const cidade   = cfg['cidade']        || '';
        const addrLine = [addr, [cp, cidade].filter(Boolean).join(' ')].filter(Boolean).join(' · ');
        if (addrLine) document.getElementById('footer-addr').textContent = addrLine;

        const instagram = cfg['instagram'] || 'https://www.instagram.com/zionlisboa/';
        const site      = cfg['site']      || 'https://zionchurch.org.br/';

        document.getElementById('footer-links').innerHTML = `
            <a class="footer-link" href="${site}" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                Site Oficial
            </a>
            <a class="footer-link" href="${instagram}" target="_blank">
                ${SVG_IG} @ZionLisboa
            </a>`;

        renderMinisterios(Array.isArray(ministerios) ? ministerios : []);

    } catch (e) {
        console.error('Ministérios init error:', e);
        document.getElementById('main-content').innerHTML =
            `<div class="empty"><div class="empty-txt">Erro ao carregar. Tenta novamente.</div></div>`;
    }
}

function renderMinisterios(list) {
    if (!list.length) {
        document.getElementById('main-content').innerHTML =
            `<div class="empty"><div class="empty-txt">Nenhum ministério disponível de momento.</div></div>`;
        return;
    }

    let html = '';

    // Card introdutório
    html += `
    <div class="card d1">
        <div class="card-text">Temos ministérios para todas as faixas etárias e áreas de serviço. Cada ministério é um espaço de crescimento, conexão e propósito dentro da Zion Lisboa.</div>
    </div>
    <p class="section-label">Nossos Ministérios</p>`;

    // Cards dos ministérios
    list.forEach((m, i) => {
        const metaItems = [];

        if (m.faixa_etaria) {
            metaItems.push(`
                <span class="min-meta-item">
                    ${SVG_USER} ${m.faixa_etaria}
                </span>`);
        }

        if (m.instagram) {
            metaItems.push(`
                <span class="min-meta-item">
                    ${SVG_IG}
                    <a href="${m.instagram}" target="_blank">Instagram</a>
                </span>`);
        }

        html += `
        <div class="card" style="animation-delay:${(i + 2) * 0.04}s">
            ${m.faixa_etaria ? `<div class="card-badge">${m.faixa_etaria}</div>` : ''}
            <div class="card-title">${m.nome}</div>
            ${m.descricao ? `<div class="card-text">${m.descricao}</div>` : ''}
            ${metaItems.length ? `<div class="min-meta">${metaItems.join('')}</div>` : ''}
        </div>`;
    });

    document.getElementById('main-content').innerHTML = html;
}

init();
</script>
</body>
</html>
